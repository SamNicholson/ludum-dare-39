<!DOCTYPE html>
<html>
<head>
    <title>Ludum Dare 39</title>
    <!-- Libraries -->
    <script type="text/javascript" src="js/libs/create.js"></script>
    <script type="text/javascript" src="js/libs/creatine.js"></script>
    <script type="text/javascript" src="js/libs/jquery.js"></script>

    <!-- Game Assets -->
    <script type="text/javascript" src="js/robot_handler.js"></script>
    <script type="text/javascript" src="js/collectible.js"></script>
    <script type="text/javascript" src="js/collectible_handler.js"></script>
    <script type="text/javascript" src="js/difficulty-incrementor.js"></script>


    <style type="text/css">
        #container {
        }
    </style>
</head>
<script type="application/javascript">

    tine.DEFAULT_CONFIG.container = 'game';
    tine.DEFAULT_CONFIG.width = 1024;
    tine.DEFAULT_CONFIG.height = 576;

    ROBOT_SIZE = 64;
    ROBOT_BOTTOM_OFFSET = 32;

    POWER_DEGRADE = -0.025;

    ROBOT_BASE_MOVEMENT_SPEED = 5;
    ROBOT_MINIMUM_MOVEMENT_SPEED = 3;
    ROBOT_SPRINT_MOVEMENT_MULTIPLIER = 2;

    COLLECTIBLE_BAD_SPAWN_CHANCE = 0.2;
    COLLECTIBLE_GOOD_SPAWN_CHANCE = 0.2;
    COLLECTIBLE_SPEED = 1.5;
    COLLECTIBLE_MAX = 10;
    COLLECTIBLE_SPAWN_INTERVAL = 1.5;
    COLLECTIBLE_SPAWN_CHANCE = 0.1;

    GAME_TIME = 0;
    GAME_START_TIME = new Date();
    GAME_SCORE = 0;

    $(function(){

        var domFps = $('#game-fps');
        // var domTick = $('#game-tick');

        setInterval(function() {
            domFps.html(Math.round(createjs.Ticker.getMeasuredFPS()));
        }, 100);

        var game = new tine.Game(null, {
            preload: function() {

                createjs.Sound.alternateExtensions = ["mp3"];
                game.load.audio('background', 'audio/BKG_HappyTempIncre.mp3', {group:'background'});
                game.load.audio('backgroundFast', 'audio/BKG_HappyTemp160.mp3', {group:'backgroundFast'});
                game.load.audio('asteroidHit', 'audio/FX_PowerPickup4BAD.mp3', {group:'asteroid'});

                game.load.image('robot', 'sprites/spaceship_red_base1.png');
                game.load.image('title', 'images/title.png');
                game.load.image('particle', 'images/particle_red.png');
                game.load.image('particleGrey', 'images/particle_gray.png');
                game.load.image('asteroid', 'sprites/asteroidA.png');
                game.load.image('planet', 'images/planet.png');


                game.load.spritesheet('collectible', 'sprites/atom.png', {
                    "framerate": 30,
                    "frames": {"regX": 16, "height": 32, "count": 8, "regY": 16, "width": 32},
                    "animations": {
                        "fly":     [0, 7, "fly", 0.1]
                    }
                });

                game.load.spritesheet('collectibleGood', 'sprites/atomsuper.png', {
                    "framerate": 30,
                    "frames": {"regX": 16, "height": 32, "count": 8, "regY": 16, "width": 32},
                    "animations": {
                        "fly":     [0, 7, "fly", 0.1]
                    }
                });

                game.load.spritesheet('redSpaceship', 'sprites/red_spaceship.png', {
                    "framerate": 30,
                    "frames": {"regX": 32, "height": 64, "count": 64, "regY": 32, "width": 64},
                    "animations": {
                        "fly":     [0, 1, "fly", 1.5],
                        "left":    [2,3, "left"],
                        "right":   [4,5, "right"],
                        "shields": [6,7, "shields", 0.1]
                    }
                });
            },

            create: function() {

                //TODO - we can add multiplayer functionality in here - initialise more robots and get them to move
                game.robots = [];
                game.robots.push(new Robot([480, 576], 'redSpaceship', game));
                game.collectibleHandler = new CollectibleHandler(game);
                game.difficultyIncrementor = new Difficulty();
                game.sound.play('background');

                game.score = game.create.text('Score: 0', {
                    font:'32px arial',
                    color:'#efefef',
                    x: game.canvas.width - 200,
                    y: game.canvas.height - 64
                });
                game.stage.addChild(game.score);

                var title = game.create.bitmap("title", {regX:'center', regY:'center', x:525, y:60});

                game.stage.addChild(title);

                //Planet 1

                var smoke = game.create.bitmap('particleGrey', {regX:'center', regY:'center'});

                planet1Smoke = new tine.Emitter(smoke, 500);
                planet1Smoke.emitX = 512;
                planet1Smoke.emitY = 288;
                planet1Smoke.emitXVar = 1000;
                planet1Smoke.emitYVar = 600;
                planet1Smoke.angle = 90;
                planet1Smoke.angleVar = 0;
                planet1Smoke.speed = 10;
                planet1Smoke.speed = 10;
                planet1Smoke.speedVar = 0;
                planet1Smoke.life = 50000;
                planet1Smoke.lifeVar = 0;
                planet1Smoke.emissionRate = 5000;
                planet1Smoke.startScale = 0.05;
                planet1Smoke.endScale = 0.1;
                planet1Smoke.endScaleVar = 0;

                planet1Smoke.start(-1);
                game.stage.addChild(planet1Smoke);

            },

            update: function() {

                $.each(game.robots, function(key, robot) {
                    robot.update(game);
                });
                game.collectibleHandler.update(game);
                game.difficultyIncrementor.update(game);
                //Handle updating the game time
                GAME_TIME = (new Date() - GAME_START_TIME)/1000;
                GAME_SCORE = Math.round(GAME_TIME * 10) / 10;
                game.score.text = 'Score: ' + GAME_SCORE;

                planet1Smoke.update(game.time.delta);

            }
        });

        game.end = function() {
            if (!game.hasEnded) {
                alert('game over');
                game.hasEnded = true;
            }
        }
    });

    function collisionCheck(rect1,rect2){

        if(rect1.y <= rect2.y){ //top edge
            // if ( rect1.x >= rect2.x + rect2.width || rect1.x + rect1.width <= rect2.x || rect1.y >= rect2.y + rect2.height || rect1.y + rect1.height <= rect2.y ){
            return false;
        }
        else if((rect2.y + rect2.height) <= rect1.y){ //bottom edge
            return false;
        }
        else if(rect1.x < rect2.x){ //left edge
            return false;
        }
        else if((rect2.x + rect2.width) <= rect1.x){ //right edge
            return false;
        }
        else{
            return true;
        }
    }c

</script>
<body onload="">
    <div id="container">
        <div id="game" width="1000px" height="600px"></div>
        <div id="place-holder">
            <div class="bg-dark gameview">
                <p class="uk-padding-left" style="padding-bottom:2px">FPS: <span id="game-fps">Constant</span></p>
        </div>
    </div>
<script>
</script>
</body>
</html>