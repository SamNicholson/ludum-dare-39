<!DOCTYPE html>
<html>
<head>
    <title>Ludum Dare 39</title>
    <!-- Libraries -->
    <script type="text/javascript" src="js/libs/create.js"></script>
    <script type="text/javascript" src="js/libs/creatine.js"></script>
    <script type="text/javascript" src="js/libs/jquery.js"></script>

    <!-- Game Assets -->
    <script type="text/javascript" src="js/robot_handler.js"></script>
    <script type="text/javascript" src="js/collectible.js"></script>
    <script type="text/javascript" src="js/collectible_handler.js"></script>


    <style type="text/css">
        #container {
        }
    </style>
</head>
<script type="application/javascript">

    tine.DEFAULT_CONFIG.container = 'game';
    tine.DEFAULT_CONFIG.width = 1024;
    tine.DEFAULT_CONFIG.height = 576;

    ROBOT_SIZE = 64;
    ROBOT_BOTTOM_OFFSET = 32;

    POWER_DEGRADE = -0.025;

    ROBOT_BASE_MOVEMENT_SPEED = 5;
    ROBOT_MINIMUM_MOVEMENT_SPEED = 3;
    ROBOT_SPRINT_MOVEMENT_MULTIPLIER = 2;

    COLLECTIBLE_BAD_SPAWN_CHANCE = 0.2;
    COLLECTIBLE_GOOD_SPAWN_CHANCE = 0.2;
    COLLECTIBLE_SPEED = 1.5;
    COLLECTIBLE_MAX = 10;
    COLLECTIBLE_SPAWN_INTERVAL = 1.5;
    COLLECTIBLE_SPAWN_CHANCE = 0.1;
    GAME_TIME = 0;
    GAME_START_TIME = new Date();

    $(function(){

        var domFps = $('#game-fps');
        // var domTick = $('#game-tick');

        setInterval(function() {
            domFps.html(Math.round(createjs.Ticker.getMeasuredFPS()));
        }, 100);

        var game = new tine.Game(null, {
            preload: function() {
                game.load.image('robot', 'sprites/spaceship_red_base1.png');
                game.load.image('collectible', 'sprites/pickup_redpower2.png');
                game.load.image('asteroid', 'sprites/asteroidA.png');
            },

            create: function() {

                //TODO - we can add multiplayer functionality in here - initialise more robots and get them to move
                game.robots = [];
                game.robots.push(new Robot([512, 526], 'robot', game));
                game.collectibleHandler = new CollectibleHandler(game);

            },

            update: function() {

                $.each(game.robots, function(key, robot) {
                    robot.update(game);
                });
                game.collectibleHandler.update(game);

                //Handle updating the game time
                GAME_TIME = (new Date() - GAME_START_TIME)/1000;
            }
        });

        game.end = function() {
            if (!game.hasEnded) {
                alert('game over');
                game.hasEnded = true;
            }
        }
    });

    function collisionCheck(rect1,rect2){

        if(rect1.y <= rect2.y){ //top edge
            // if ( rect1.x >= rect2.x + rect2.width || rect1.x + rect1.width <= rect2.x || rect1.y >= rect2.y + rect2.height || rect1.y + rect1.height <= rect2.y ){
            return false;
        }
        else if((rect2.y + rect2.height) <= rect1.y){ //bottom edge
            return false;
        }
        else if(rect1.x < rect2.x){ //left edge
            return false;
        }
        else if((rect2.x + rect2.width) <= rect1.x){ //right edge
            return false;
        }
        else{
            return true;
        }
    }

</script>
<body onload="">
    <div id="container">
        <div id="game" width="1000px" height="600px"></div>
        <div id="place-holder">
            <div class="bg-dark gameview">
                <p class="uk-padding-left" style="padding-bottom:2px">FPS: <span id="game-fps">Constant</span></p>
        </div>
    </div>
<script>
</script>
</body>
</html>